<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-gb">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Getting Started with Drupal - ContinuousPipe Docs</title>
    <meta name="generator" content="Hugo 0.18" />

    
    <meta name="description" content="Documentation for ContinuousPipe">
    
    <link rel="canonical" href="../../guides/drupal/">
    
    <meta name="author" content="Samuel Rozé">
    

    <meta property="og:url" content="/guides/drupal/">
    <meta property="og:title" content="ContinuousPipe Docs">
    <meta property="og:image" content="/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="ContinuousPipe Docs">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="../../images/favicon.png">
    <link rel="icon" type="image/x-icon" href="../../images/favicon.png">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('/fonts/icon.eot');
        src: url('/fonts/icon.eot')
               format('embedded-opentype'),
             url('/fonts/icon.woff')
               format('woff'),
             url('/fonts/icon.ttf')
               format('truetype'),
             url('/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="../../stylesheets/application.css">
    <link rel="stylesheet" href="../../stylesheets/temporary.css">
    <link rel="stylesheet" href="../../stylesheets/palettes.css">
    <link rel="stylesheet" href="../../stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open%20Sans:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Open Sans', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css">
    
    <link rel="stylesheet" href="../../stylesheets/custom.css">
    
    <script src="../../javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-blue palette-accent-teal">


<div class="backdrop">
    <div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
    <nav aria-label="Header">
    <div class="bar default">
        <div class="button button-menu" role="button" aria-label="Menu">
            <label class="toggle-button icon icon-menu" for="toggle-drawer">
                <span></span>
            </label>
        </div>
        <div class="stretch">
            <div class="title">
                <a href="https://continuouspipe.github.io/" class="cp-website-link"><i class="cp-icon-logo"></i></a>
                <a href="../../">ContinuousPipe
                    Documentation</a>
            </div>
        </div>

        
        <div class="button button-twitter" role="button" aria-label="Twitter">
            <a href="https://twitter.com/continuouspipe" title="@continuouspipe on Twitter" target="_blank"
               class="toggle-button icon icon-twitter"></a>
        </div>
        

        
        <div class="button button-github" role="button" aria-label="GitHub">
            <a href="https://github.com/continuouspipe" title="@continuouspipe on GitHub" target="_blank"
               class="toggle-button icon icon-github"></a>
        </div>
        

        <div class="button button-search" role="button" aria-label="Search">
            <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
        </div>
    </div>
    <div class="bar search">
        <div class="button button-close" role="button" aria-label="Close">
            <label class="toggle-button icon icon-back" for="toggle-search"></label>
        </div>
        <div class="stretch">
            <div class="field">
                <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off"
                       autocomplete="off" spellcheck id="algolia-query">
            </div>
        </div>
        <div class="button button-reset" role="button" aria-label="Search">
            <button class="toggle-button icon icon-close" id="reset-search"></button>
        </div>
    </div>
</nav>

</header>

<main class="main">
    <div class="drawer">
        <nav aria-label="Navigation">
  <div class="scrollable">
    <div class="wrapper">
      

      <div class="toc">
        
        <ul>
          



    
    
    <li>
        



<a  title="Basics" href="../../basics/">
	
	Basics
</a>


        
        <ul >
           
            
            



<a  title="ContinuousPipe" href="../../basics/continuous-pipe/">
	
	ContinuousPipe
</a>

           
            
            



<a  title="Concepts: ContinuousPipe Concepts" href="../../basics/concepts-continuous-pipe-concepts/">
	
	Concepts: ContinuousPipe Concepts
</a>

           
            
            



<a  title="Concepts: Configuration Concepts" href="../../basics/concepts-configuration-concepts/">
	
	Concepts: Configuration Concepts
</a>

           
            
            



<a  title="Concepts: Build Concepts" href="../../basics/concepts-build-concepts/">
	
	Concepts: Build Concepts
</a>

           
            
            



<a  title="Concepts: Deployment Concepts" href="../../basics/concepts-deployment-concepts/">
	
	Concepts: Deployment Concepts
</a>

           
            
            



<a  title="Workflow Principles" href="../../basics/workflow-principles/">
	
	Workflow Principles
</a>

           
            
            



<a  title="Installation: GitHub" href="../../basics/installation-github/">
	
	Installation: GitHub
</a>

           
            
            



<a  title="Installation: Bitbucket" href="../../basics/installation-bitbucket/">
	
	Installation: Bitbucket
</a>

          
        </ul>
      
    </li>



    
    
    <li>
        



<a  title="Quick Start" href="../../quick-start/">
	
	Quick Start
</a>


        
        <ul >
           
            
            



<a  title="Creating a Project" href="../../quick-start/creating-a-project/">
	
	Creating a Project
</a>

           
            
            



<a  title="Creating a Flow" href="../../quick-start/creating-a-flow/">
	
	Creating a Flow
</a>

           
            
            



<a  title="Configuring Users" href="../../quick-start/configuring-users/">
	
	Configuring Users
</a>

           
            
            



<a  title="Configuring a Cluster" href="../../quick-start/configuring-a-cluster/">
	
	Configuring a Cluster
</a>

           
            
            



<a  title="Configuring a Registry" href="../../quick-start/configuring-a-registry/">
	
	Configuring a Registry
</a>

           
            
            



<a  title="Configuring Your Repository" href="../../quick-start/configuring-your-repository/">
	
	Configuring Your Repository
</a>

           
            
            



<a  title="Configuring a Flow" href="../../quick-start/configuring-a-flow/">
	
	Configuring a Flow
</a>

           
            
            



<a  title="Creating a Tide" href="../../quick-start/creating-a-tide/">
	
	Creating a Tide
</a>

           
            
            



<a  title="Remote Development: Installing the Client" href="../../quick-start/remote-development-installing-the-client/">
	
	Remote Development: Installing the Client
</a>

           
            
            



<a  title="Remote Development: Configuring Your Repository" href="../../quick-start/remote-development-configuring-your-repository/">
	
	Remote Development: Configuring Your Repository
</a>

           
            
            



<a  title="Remote Development: Creating a Remote Environment" href="../../quick-start/remote-development-creating-a-remote-environment/">
	
	Remote Development: Creating a Remote Environment
</a>

           
            
            



<a  title="Remote Development: Using a Remote Environment" href="../../quick-start/remote-development-using-a-remote-environment/">
	
	Remote Development: Using a Remote Environment
</a>

          
        </ul>
      
    </li>



    
    
    <li>
        



<a  title="Configuration" href="../../configuration/">
	
	Configuration
</a>


        
        <ul >
           
            
            



<a  title="Configuration Files" href="../../configuration/configuration-files/">
	
	Configuration Files
</a>

           
            
            



<a  title="Tasks" href="../../configuration/tasks/">
	
	Tasks
</a>

           
            
            



<a  title="Tasks: Building Docker Images" href="../../configuration/tasks-build/">
	
	Tasks: Building Docker Images
</a>

           
            
            



<a  title="Tasks: Deploying Services" href="../../configuration/tasks-deploy/">
	
	Tasks: Deploying Services
</a>

           
            
            



<a  title="Tasks: Running Commands" href="../../configuration/tasks-run/">
	
	Tasks: Running Commands
</a>

           
            
            



<a  title="Tasks: Waiting Statuses" href="../../configuration/tasks-wait/">
	
	Tasks: Waiting Statuses
</a>

           
            
            



<a  title="Tasks: Manual Approval" href="../../configuration/tasks-manual-approval/">
	
	Tasks: Manual Approval
</a>

           
            
            



<a  title="Tasks: Creating Webhooks" href="../../configuration/tasks-webhook/">
	
	Tasks: Creating Webhooks
</a>

           
            
            



<a  title="Notifications" href="../../configuration/notifications/">
	
	Notifications
</a>

           
            
            



<a  title="Pipelines" href="../../configuration/pipelines/">
	
	Pipelines
</a>

           
            
            



<a  title="Cloudflare Integration" href="../../configuration/cloudflare-integration/">
	
	Cloudflare Integration
</a>

           
            
            



<a  title="Endpoints" href="../../configuration/endpoints/">
	
	Endpoints
</a>

           
            
            



<a  title="Artifacts" href="../../configuration/artifacts/">
	
	Artifacts
</a>

          
        </ul>
      
    </li>



    
    
    <li>
        



<a  title="Remote Development" href="../../remote-development/">
	
	Remote Development
</a>


        
        <ul >
           
            
            



<a  title="Getting Started" href="../../remote-development/getting-started/">
	
	Getting Started
</a>

           
            
            



<a  title="Working with a Different Environment" href="../../remote-development/working-with-different-environments/">
	
	Working with a Different Environment
</a>

           
            
            



<a  title="Working with a Direct Connection to the Cluster" href="../../remote-development/working-with-direct-cluster-connection/">
	
	Working with a Direct Connection to the Cluster
</a>

           
            
            



<a  title="Advanced Setup" href="../../remote-development/advanced-setup/">
	
	Advanced Setup
</a>

           
            
            



<a  title="Command: Init" href="../../remote-development/command-init/">
	
	Command: Init
</a>

           
            
            



<a  title="Command: Setup" href="../../remote-development/command-setup/">
	
	Command: Setup
</a>

           
            
            



<a  title="Command: Build" href="../../remote-development/command-build/">
	
	Command: Build
</a>

           
            
            



<a  title="Command: Logs" href="../../remote-development/command-logs/">
	
	Command: Logs
</a>

           
            
            



<a  title="Command: Bash" href="../../remote-development/command-bash/">
	
	Command: Bash
</a>

           
            
            



<a  title="Command: Exec" href="../../remote-development/command-exec/">
	
	Command: Exec
</a>

           
            
            



<a  title="Command: Watch" href="../../remote-development/command-watch/">
	
	Command: Watch
</a>

           
            
            



<a  title="Command: Fetch" href="../../remote-development/command-fetch/">
	
	Command: Fetch
</a>

           
            
            



<a  title="Command: Push" href="../../remote-development/command-push/">
	
	Command: Push
</a>

           
            
            



<a  title="Command: Sync" href="../../remote-development/command-sync/">
	
	Command: Sync
</a>

           
            
            



<a  title="Command: Delete" href="../../remote-development/command-delete/">
	
	Command: Delete
</a>

           
            
            



<a  title="Command: Forward" href="../../remote-development/command-forward/">
	
	Command: Forward
</a>

           
            
            



<a  title="Command: Pods" href="../../remote-development/command-pods/">
	
	Command: Pods
</a>

           
            
            



<a  title="Command: Check Connection" href="../../remote-development/command-check-connection/">
	
	Command: Check Connection
</a>

           
            
            



<a  title="Command: Destroy" href="../../remote-development/command-destroy/">
	
	Command: Destroy
</a>

           
            
            



<a  title="Release Notes v0.1.0" href="../../remote-development/release-notes-0-1-0/">
	
	Release Notes v0.1.0
</a>

           
            
            



<a  title="Release Notes v0.1.1" href="../../remote-development/release-notes-0-1-1/">
	
	Release Notes v0.1.1
</a>

           
            
            



<a  title="Release Notes v0.1.2" href="../../remote-development/release-notes-0-1-2/">
	
	Release Notes v0.1.2
</a>

           
            
            



<a  title="Release Notes v0.1.3" href="../../remote-development/release-notes-0-1-3/">
	
	Release Notes v0.1.3
</a>

           
            
            



<a  title="Release Notes v0.1.4" href="../../remote-development/release-notes-0-1-4/">
	
	Release Notes v0.1.4
</a>

           
            
            



<a  title="Release Notes v0.1.5" href="../../remote-development/release-notes-0-1-5/">
	
	Release Notes v0.1.5
</a>

          
        </ul>
      
    </li>



    
    
    <li>
        



<a  title="FAQ" href="../../faq/">
	
	FAQ
</a>


        
        <ul >
           
            
            



<a  title="Billing Profile" href="../../faq/how-do-I-create-a-billing-profile/">
	
	Billing Profile
</a>

           
            
            



<a  title="ContinuousPipe Images" href="../../faq/what-are-the-continuous-pipe-images/">
	
	ContinuousPipe Images
</a>

           
            
            



<a  title="ContinuousPipe Demo Sites" href="../../faq/what-are-the-continuous-pipe-demo-sites/">
	
	ContinuousPipe Demo Sites
</a>

           
            
            



<a  title="ContinuousPipe API Keys" href="../../faq/where-can-I-get-a-continuous-pipe-api-key/">
	
	ContinuousPipe API Keys
</a>

           
            
            



<a  title="Deployment Logs and Events" href="../../faq/where-can-I-view-container-logs-and-events/">
	
	Deployment Logs and Events
</a>

           
            
            



<a  title="Setting Environment Variables" href="../../faq/how-do-I-set-environment-variables/">
	
	Setting Environment Variables
</a>

           
            
            



<a  title="Controlling Deployments" href="../../faq/how-do-I-control-deployments-using-pr-labels/">
	
	Controlling Deployments
</a>

           
            
            



<a  title="Using Defaults" href="../../faq/how-do-I-use-defaults-to-reduce-the-duplication-of-configuration/">
	
	Using Defaults
</a>

           
            
            



<a  title="Setup GitHub Token" href="../../faq/how-do-I-use-composer-with-github-access-token/">
	
	Setup GitHub Token
</a>

           
            
            



<a  title="Using Pipelines" href="../../faq/how-do-I-use-pipelines-to-simplify-the-configuration/">
	
	Using Pipelines
</a>

           
            
            



<a  title="Basic Authentication" href="../../faq/how-do-I-add-basic-http-authentication-to-an-application/">
	
	Basic Authentication
</a>

           
            
            



<a  title="Overriding Tasks" href="../../faq/how-do-I-override-tasks-in-pipelines/">
	
	Overriding Tasks
</a>

           
            
            



<a  title="Manual Approval" href="../../faq/how-do-I-set-up-manual-approval-of-deployments/">
	
	Manual Approval
</a>

           
            
            



<a  title="Readiness Checks on Services" href="../../faq/how-do-I-define-a-readiness-check-when-deploying-services/">
	
	Readiness Checks on Services
</a>

           
            
            



<a  title="Get Endpoint Address for a Service" href="../../faq/how-do-I-get-the-deployed-endpoint-address-for-a-service/">
	
	Get Endpoint Address for a Service
</a>

           
            
            



<a  title="Slack Notifications" href="../../faq/how-do-I-configure-slack-notifications/">
	
	Slack Notifications
</a>

           
            
            



<a  title="Watch Commands and Inotify" href="../../faq/how-do-I-configure-inotify-for-development-tool-watch-commands/">
	
	Watch Commands and Inotify
</a>

          
        </ul>
      
    </li>



    
    
    <li>
        



<a class="current" title="Guides" href="../../guides/">
	
	Guides
</a>


        
        <ul class="current">
           
            
            



<a  title="Getting Started with Laravel" href="../../guides/laravel/">
	
	Getting Started with Laravel
</a>

           
            
            



<a  title="Getting Started with Symfony" href="../../guides/symfony/">
	
	Getting Started with Symfony
</a>

           
            
            



<a class="current" title="Getting Started with Drupal" href="../../guides/drupal/">
	
	Getting Started with Drupal
</a>

           
            
            



<a  title="Xdebug Remote Environment" href="../../guides/remote-environment-xdebug/">
	
	Xdebug Remote Environment
</a>

          
        </ul>
      
    </li>



        </ul>
        

      </div>
    </div>
  </div>
</nav>

    </div>

    <article class="article">
        <div class="wrapper">
            
<h1>Getting Started with Drupal </h1>



<h2 id="introduction">Introduction</h2>

<p>This is a guide to getting Drupal 8 running on ContinuousPipe with a remote development environment. The code samples used in the guide can be seen at <a href="https://github.com/continuouspipe/demo-drupal8">https://github.com/continuouspipe/demo-drupal8</a>.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>Before getting started you will need the following:</p>

<ul>
<li>A <a href="https://github.com/">GitHub</a> or <a href="https://bitbucket.org/">Bitbucket</a> account to host your Drupal project</li>
<li>A <a href="https://continuouspipe.github.io/">ContinuousPipe</a> account</li>
<li>A Kubernetes cluster e.g. <a href="https://aws.amazon.com/">AWS</a>, <a href="https://cloud.google.com/container-engine/">GCE</a> or <a href="https://azure.microsoft.com/en-au/">Azure</a></li>
<li>A Docker Registry account e.g. <a href="https://docker.io">docker.io</a> or <a href="https://quay.io">quay.io</a></li>
</ul>

<p>You will also need Git and Composer installed on your local machine to follow these instructions.</p>

<h2 id="setting-up-drupal-8">Setting Up Drupal 8</h2>

<h3 id="creating-a-skeleton-drupal-8-project">Creating a Skeleton Drupal 8 Project</h3>

<p>Whilst you can start from scratch and add the necessary configuration later, the quickest way to get started is to download the example project from GitHub and use this as the basis for your project. Download the following repository and unzip:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>https://github.com/continuouspipe/demo-drupal8/archive/master.zip
</pre></div>

<h3 id="connecting-to-the-github-repository">Connecting to the GitHub Repository</h3>

<p>Move to the downloaded project directory:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">cd</span> demo-drupal8
</pre></div>

<p>Create a local git repository:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>git init
</pre></div>

<p>Commit the initial installation:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>git add . <span style="color: #f92672">&amp;&amp;</span> git commit -m <span style="color: #e6db74">&quot;Initial installation of Drupal 8&quot;</span>
</pre></div>

<p>Add a GitHub repository as a remote:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>git remote add origin git@github.com:continuouspipe/demo-drupal8.git
<span style="color: #75715e">#replacing the organisation and repository with your repository</span>
</pre></div>

<h2 id="integrating-drupal-with-continuouspipe">Integrating Drupal with ContinuousPipe</h2>

<h3 id="adding-docker-configuration-files">Adding Docker Configuration Files</h3>

<p>The example project has a <code>Dockerfile</code> included in the project root with the following content:</p>

<blockquote>
<p><strong>Dockerfile</strong></p>

<pre><code>FROM quay.io/continuouspipe/drupal8-apache-php7:stable

# Add the application
COPY . /app
WORKDIR /app

COPY ./tools/docker/usr/ /usr

ARG GITHUB_TOKEN=
ARG CODE_OWNER=build
ARG CODE_GROUP=build
ARG APP_USER=www-data
ARG APP_GROUP=www-data

RUN container build

</code></pre>
</blockquote>

<p>The Dockerfile is used to specify how the Docker image is built. It is based on a prebuilt image created specifically for Drupal 8 running on Apache. This is one of several <a href="../../faq/what-are-the-continuous-pipe-images/">ContinuousPipe images</a> that can be found at <a href="https://github.com/continuouspipe/dockerfiles">https://github.com/continuouspipe/dockerfiles</a>.</p>

<p>The <a href="https://github.com/continuouspipe/dockerfiles/blob/master/drupal8-apache/7.0/README.md">README</a> for the prebuilt image lists the arguments that can be passed when it is initialised, including environment variables. The repository project code is copied onto the image and a script is run which will do things like install the vendors with composer.</p>

<p>The demo project also includes an example <code>docker-compose.yml</code> file in the project root.</p>

<blockquote>
<p><strong>docker-compose.yml</strong></p>

<pre><code>version: '2'
services:
  web:
    build:
      context: .
      args:
        - GITHUB_TOKEN
        - CODE_OWNER=build
        - CODE_GROUP=build
        - APP_USER=www-data
        - APP_GROUP=www-data
    links:
      - database
    environment:
      - GITHUB_TOKEN
      - WEB_HTTP=true
      - WEB_HTTPS=false
      - DRUPAL_HASH_SALT=sosecret
      - DRUPAL_DATABASE_NAME=drupaldb
      - DRUPAL_DATABASE_USERNAME=drupal
      - DRUPAL_DATABASE_PASSWORD=drupal
      - DRUPAL_DATABASE_HOST=database
      - DRUPAL_DATABASE_PORT=3306
      - DEVELOPMENT_MODE=0
      - DRUPAL_ADMIN_USERNAME=drupaluser
      - DRUPAL_ADMIN_PASSWORD=drupalpass
    expose:
      - 80

  database:
    image: quay.io/continuouspipe/mysql5.6:v1.0
    environment:
      MYSQL_ROOT_PASSWORD: drupal
      MYSQL_DATABASE: drupaldb
      MYSQL_USER: drupal
      MYSQL_PASSWORD: drupal
    expose:
      - 3306

</code></pre>
</blockquote>

<p>ContinuousPipe uses the <code>docker-compose.yml</code> configuration to know how to build and configure the services that it deploys. Here we deploy the minimum requirements for Drupal 8 - a web service and a database.</p>

<h3 id="adding-continuouspipe-configuration-file">Adding ContinuousPipe Configuration File</h3>

<p>The demo project contains  a <code>continuous-pipe.yml</code> file in the project root with a basic configuration.</p>

<blockquote>
<p><strong>continuous-pipe.yml</strong></p>

<pre><code>variables:
  - name: CP_ENVIRONMENT
    value: prod

tasks:
  images:
    build:
      services:
        web:
          image: ${IMAGE_NAME}
          naming_strategy: sha1

  db_deployment:
    deploy:
      cluster: ${CLUSTER}
      environment:
        name: '&quot;demo-drupal8-&quot; ~ code_reference.branch'
      services:
        database:
          specification:
            volumes:
              - type: persistent
                name: database-volume
                capacity: 5Gi
                storage_class: default
            volume_mounts:
              - name: database-volume
                mount_path: /var/lib/mysql
            command:
              - /usr/local/bin/docker-entrypoint.sh
              - mysqld
              - --ignore-db-dir=lost+found
              - --max_allowed_packet=128M
            ports:
              - 3306
            resources:
              requests:
                cpu: 50m
                memory: 250Mi
              limits:
                cpu: 500m
                memory: 2Gi
            environment_variables:
              - name: MYSQL_ROOT_PASSWORD
                value: ${DATABASE_ROOT_PASSWORD}
              - name: MYSQL_USER
                value: ${DRUPAL_DATABASE_USERNAME}
              - name: MYSQL_PASSWORD
                value: ${DRUPAL_DATABASE_PASSWORD}
              - name: MYSQL_DATABASE
                value: ${DRUPAL_DATABASE_NAME}
          deployment_strategy:
              readiness_probe:
                 type: tcp
                 port: 3306

  web_deployment:
    deploy:
      cluster: ${CLUSTER}
      environment:
        name: '&quot;demo-drupal8-&quot; ~ code_reference.branch'
      services:
        web:
          specification:
            accessibility:
              from_external: true
            volumes:
              - type: persistent
                name: web-public-files-volume
                capacity: 5Gi
                storage_class: default
            volume_mounts:
              - name: web-public-files-volume
                mount_path: /app/docroot/sites/default/files
            environment_variables: &amp;default_web_variables
              - name: DRUPAL_DATABASE_NAME
                value: ${DRUPAL_DATABASE_NAME}
              - name: DRUPAL_DATABASE_USERNAME
                value: ${DRUPAL_DATABASE_USERNAME}
              - name: DRUPAL_DATABASE_PASSWORD
                value: ${DRUPAL_DATABASE_PASSWORD}
              - name: DRUPAL_DATABASE_PREFIX
                value: ${DRUPAL_DATABASE_PREFIX}
              - name: DRUPAL_DATABASE_HOST
                value: ${DRUPAL_DATABASE_HOST}
              - name: DRUPAL_DATABASE_PORT
                value: ${DRUPAL_DATABASE_PORT}
              - name: CP_ENVIRONMENT
                value: ${CP_ENVIRONMENT}
              - name: INSTALL_DRUPAL
                value: ${INSTALL_DRUPAL}
              - name: DRUPAL_ADMIN_USERNAME
                value: ${DRUPAL_ADMIN_USERNAME}
              - name: DRUPAL_ADMIN_PASSWORD
                value: ${DRUPAL_ADMIN_PASSWORD}
              - name: DEVELOPMENT_MODE
                value: ${DEVELOPMENT_MODE}
            ports:
              - 80
            resources:
              requests:
                cpu: 50m
                memory: 500Mi
              limits:
                cpu: 1
                memory: 2G

  drupal_demo_install:
    run:
      cluster: ${CLUSTER}
      environment:
        name: '&quot;demo-drupal8-&quot; ~ code_reference.branch'
      image:
        from_service: web
      commands:
        - container drupal_install
      environment_variables: *default_web_variables


pipelines:
  - name: Remote development
    condition: code_reference.branch matches &quot;/^cpdev/&quot;
    tasks: &amp;default_tasks
      - images
      - db_deployment
      - drupal_demo_install
      - web_deployment
    variables:
      - name: CP_ENVIRONMENT
        value: dev

  - name: Production
    condition: 'not(code_reference.branch matches &quot;/^cpdev/&quot;)'
    tasks: *default_tasks

</code></pre>
</blockquote>

<p>This defines four tasks for ContinuousPipe.</p>

<ol>
<li><code>images</code> builds a Docker image for the web service based on the matching configuration for the web service in the <code>docker-compose.yml</code> file. The built image will include the repository contents in the commit that triggered the build (because of the instructions in the <code>Dockerfile</code> in the previous step). Once the image is built ContinuousPipe will push it to an image registry configured using the <code>IMAGE_NAME</code> variable (setting this variable is explained later).</li>
<li><code>db_deployment</code> deploys the database services to a cluster set with the <code>CLUSTER</code> variable (setting this variable is explained later). The environment name used to refer to the deployment is made consistent by combining <code>demo-drupal8-</code> with the name of the branch that triggered the process.</li>
<li><code>web_deployment</code> deploys the web container running apache.</li>
<li><code>drupal_demo_install</code> - runs the intial Drupal installation.</li>
</ol>

<p>The ContinousPipe documentation has more information about <a href="../../configuration/tasks/">tasks</a>.</p>

<h3 id="configuring-the-continuouspipe-console">Configuring the ContinuousPipe Console</h3>

<p>Before we can push any code to our repository, we need to ensure that the ContinuousPipe console is properly configured. Please refer to the ContinuousPipe Quick Start guide to setup your <a href="../../quick-start/creating-a-project/">project</a>, <a href="../../quick-start/configuring-a-cluster/">cluster</a>, <a href="../../quick-start/configuring-a-registry/">registry</a> and create your first <a href="../../quick-start/creating-a-flow/">flow</a>.</p>

<h3 id="adding-variables-to-the-continuouspipe-console">Adding Variables to the ContinuousPipe Console</h3>

<p>When creating the <code>continuous-pipe.yml</code> above an <code>IMAGE_NAME</code> and <code>CLUSTER</code> variable were used. These can now be added in the configuration section of the new flow within the ContinuousPipe console. This is explained in <a href="../../quick-start/configuring-a-flow/">configuring a flow</a>.</p>

<p>The <code>CLUSTER</code> value you need can be found in the &ldquo;Clusters&rdquo; tab of the project. If you manually entered the Kubernetes cluster details you will have set the value yourself. If you used a Google linked account the value will have been set when setting up the Google Container Engine.</p>

<p>The <code>IMAGE_NAME</code> value is the path where the Docker image should be pushed to. This needs to be the full name, including the Docker repo and account e.g. <code>docker.io/continuouspipe/demo-drupal8</code>. If you don&rsquo;t yet have a Docker repo nor do you know how to create one, please refer to the <a href="https://docs.docker.com/docker-hub/repos/">Docker Hub repositories documentation</a>.</p>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The variables can also have their values provided in the <code>continuous-pipe.yml</code> file as is done below for the symfony environment. Keeping them out of the file and in the ContinuousPipe console allows you to keep them out of your code repository.</p>
</div>

<h3 id="initiating-a-tide">Initiating a Tide</h3>

<p>Commit any changes if not already done and push them to your code repository. You should be able to see that a tide was triggered on the overview or tides pages for the flow on <a href="https://your-ui.example.com">https://your-ui.example.com</a>.</p>

<p><img src="../../images/guides/drupal/cp-tide-running.png" alt="" /></p>

<p>Clicking on the status will show more details of the build progressing. Some steps, particularly building the image and pushing it to the registry, may take a while to complete. Once it has completed running successfully you can view the environment and from there open the web service and see the running application. The default Drupal page should be visible.</p>

<h2 id="remote-development-with-continuouspipe">Remote Development with ContinuousPipe</h2>

<h3 id="install-the-client">Install the Client</h3>

<p>To use ContinuousPipe as a remote development environment you will need the <code>cp-remote</code> client, which is available on OSX, Linux and Windows. Please refer to the <a href="../../remote-development/getting-started/#installation">remote development installation instructions</a> for each of the platforms.</p>

<h3 id="run-setup">Run Setup</h3>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span> cp-remote setup
</pre></div>

<p>You will now be asked a series of questions that relate to how you have configured ContinuousPipe and your cluster details. Please refer to the <a href="../../remote-development/command-setup/">remote development setup instructions</a> for more information.</p>

<h3 id="build-the-remote-environment">Build the Remote Environment</h3>

<p>To create the remote development environment run:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>cp-remote build
</pre></div>

<p>This will force push the current commit you have checked out as the remote environment branch. So assuming you are still on the master branch and at the commit that successfully created an environment, this will be used to create your initial remote environment. You can rerun the <code>cp-remote build</code> command to rebuild the remote environment with whatever you have checked out at that point as needed. However, you should not need to do this frequently if you use <code>cp-remote watch</code> to sync changes to your remote environment as you make them (explained below).</p>

<h3 id="development-mode">Development Mode</h3>

<p>The default configuration described above has two build pipelines defined.
This adds two different pipelines which use conditions to determine which pipeline is used. In this case it checks if the branch starts with <code>cpdev</code> - if it does then the Remote pipeline is used, if not the Production pipeline is used. You could use this to run different tasks but here the same tasks are run but variables have different values set. The YAML variable being used is named <code>CP_ENVIRONMENT</code> which is declared and initialised to “prod” at the top of the file. It stays as “prod” for the Production pipeline but is set to “dev” for remote environments.</p>

<h3 id="rebuild-the-remote-environment">Rebuild the Remote Environment</h3>

<p>To rebuild the remote environment with these changes, commit them to <code>master</code> and run <code>cp-remote build</code> - this will establish the Production pipeline. You can now switch to a branch prefixed with <code>cpdev</code> and run <code>cp-remote build</code> again to establish the Remote pipeline. You will then see the two new pipelines on the overview page in the ContinuousPipe console.</p>

<h3 id="start-development">Start Development</h3>

<p>To start development run:</p>

<p><code>cp-remote watch</code></p>

<p>You can now make changes and they will be synced to the remote environment where you should be able to see the result.</p>

<h3 id="configuration-management-in-drupal-8">Configuration Management in Drupal 8</h3>

<p>The main workflow adjustment you will have to make for Drupal 8 remote development is using <code>cp-watch</code> to sync your changes. For example, if you want to make a change to configuration, take the following steps:</p>

<ol>
<li>Make the change in the UI of the remote environment.</li>
<li>Export as a feature or using Configuration Export</li>
<li><code>cp-remote fetch</code> will rsync the files from the container back to your local machine</li>
<li>Commit the changes in Git</li>
</ol>

<p>If you are doing custom development, any change you make will immediately be on the container as soon as you save via <code>cp-watch</code> (including deletion).</p>

<h3 id="drush-and-drupal-console">Drush and Drupal Console</h3>

<p>Drush and Drupal Console are both available in this demonstration setup. To use them:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>cp-remote bash
</pre></div>

<p>You will then have a bash shell open on the web container.</p>



        </div>
    </article>

    <footer class="footer" style="margin-top: 20px;">
        





<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="../../guides/symfony/" title="Getting Started with Symfony">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Getting Started with Symfony
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="../../guides/remote-environment-xdebug/" title="Setting up Xdebug on a Remote Environment">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Setting up Xdebug on a Remote Environment
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





    </footer>

    <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
            <div class="wrapper">
                <div class="meta"></div>
                <div class="list"></div>
            </div>
        </div>
    </div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="../../javascripts/application.js"></script>
    
    <script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
    
    <script src="../../javascripts/jquery-3.1.1.min.js"></script>
    
    <script src="../../javascripts/menu.js"></script>
    

    <script>
    /* Removes redundant event listener from material theme */
    window.addEventListener('load', function () {
        var searchToggle = document.querySelector("#toggle-search");
        var searchLabel = document.querySelector("[for=\"toggle-search\"]");
        var algoliaInput = document.querySelector("#algolia-query");

        function elementReset(elem) {
            elem.parentNode.replaceChild(elem.cloneNode(true), elem);
        }

        elementReset(searchToggle);
        searchLabel.addEventListener('click', function() {
            algoliaInput.focus();
        }, false);
    }, false);
    </script>

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>
    <script type="text/javascript"> 
    docsearch({
        apiKey: '608036855612fb9a0dd2e9a2c09955bc',
        indexName: 'continuouspipe',
        inputSelector: '#algolia-query',
        debug: true 
    });
    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-71216332-1', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>

