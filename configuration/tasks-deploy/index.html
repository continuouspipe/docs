<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-gb">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Tasks: Deploying Services - ContinuousPipe Docs</title>
    <meta name="generator" content="Hugo 0.18" />

    
    <meta name="description" content="Documentation for ContinuousPipe">
    
    <link rel="canonical" href="../../docs/configuration/tasks-deploy/">
    
    <meta name="author" content="Samuel RozÃ©">
    

    <meta property="og:url" content="/docs/configuration/tasks-deploy/">
    <meta property="og:title" content="ContinuousPipe Docs">
    <meta property="og:image" content="/docs/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="ContinuousPipe Docs">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="../../docs/images/favicon.png">
    <link rel="icon" type="image/x-icon" href="../../docs/images/favicon.png">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('/docs/fonts/icon.eot');
        src: url('/docs/fonts/icon.eot')
               format('embedded-opentype'),
             url('/docs/fonts/icon.woff')
               format('woff'),
             url('/docs/fonts/icon.ttf')
               format('truetype'),
             url('/docs/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="../../docs/stylesheets/application.css">
    <link rel="stylesheet" href="../../docs/stylesheets/temporary.css">
    <link rel="stylesheet" href="../../docs/stylesheets/palettes.css">
    <link rel="stylesheet" href="../../docs/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open%20Sans:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Open Sans', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css">
    
    <link rel="stylesheet" href="../../docs/stylesheets/custom.css">
    
    <script src="../../docs/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-blue palette-accent-teal">


<div class="backdrop">
    <div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
    <nav aria-label="Header">
    <div class="bar default">
        <div class="button button-menu" role="button" aria-label="Menu">
            <label class="toggle-button icon icon-menu" for="toggle-drawer">
                <span></span>
            </label>
        </div>
        <div class="stretch">
            <div class="title">
                <a href="https://continuouspipe.github.io/" class="cp-website-link"><i class="cp-icon-logo"></i></a>
                <a href="../../docs/">ContinuousPipe
                    Documentation</a>
            </div>
        </div>

        
        <div class="button button-twitter" role="button" aria-label="Twitter">
            <a href="https://twitter.com/continuouspipe" title="@continuouspipe on Twitter" target="_blank"
               class="toggle-button icon icon-twitter"></a>
        </div>
        

        
        <div class="button button-github" role="button" aria-label="GitHub">
            <a href="https://github.com/continuouspipe" title="@continuouspipe on GitHub" target="_blank"
               class="toggle-button icon icon-github"></a>
        </div>
        

        <div class="button button-search" role="button" aria-label="Search">
            <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
        </div>
    </div>
    <div class="bar search">
        <div class="button button-close" role="button" aria-label="Close">
            <label class="toggle-button icon icon-back" for="toggle-search"></label>
        </div>
        <div class="stretch">
            <div class="field">
                <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off"
                       autocomplete="off" spellcheck id="algolia-query">
            </div>
        </div>
        <div class="button button-reset" role="button" aria-label="Search">
            <button class="toggle-button icon icon-close" id="reset-search"></button>
        </div>
    </div>
</nav>

</header>

<main class="main">
    <div class="drawer">
        <nav aria-label="Navigation">
  <div class="scrollable">
    <div class="wrapper">
      

      <div class="toc">
        
        <ul>
          



    
    
    <li>
        



<a  title="Basics" href="../../docs/basics/">
	
	Basics
</a>


        
        <ul >
           
            
            



<a  title="ContinuousPipe" href="../../docs/basics/continuous-pipe/">
	
	ContinuousPipe
</a>

           
            
            



<a  title="Concepts: ContinuousPipe Concepts" href="../../docs/basics/concepts-continuous-pipe-concepts/">
	
	Concepts: ContinuousPipe Concepts
</a>

           
            
            



<a  title="Concepts: Configuration Concepts" href="../../docs/basics/concepts-configuration-concepts/">
	
	Concepts: Configuration Concepts
</a>

           
            
            



<a  title="Concepts: Build Concepts" href="../../docs/basics/concepts-build-concepts/">
	
	Concepts: Build Concepts
</a>

           
            
            



<a  title="Concepts: Deployment Concepts" href="../../docs/basics/concepts-deployment-concepts/">
	
	Concepts: Deployment Concepts
</a>

           
            
            



<a  title="Workflow Principles" href="../../docs/basics/workflow-principles/">
	
	Workflow Principles
</a>

           
            
            



<a  title="Installation: GitHub" href="../../docs/basics/installation-github/">
	
	Installation: GitHub
</a>

           
            
            



<a  title="Installation: Bitbucket" href="../../docs/basics/installation-bitbucket/">
	
	Installation: Bitbucket
</a>

          
        </ul>
      
    </li>



    
    
    <li>
        



<a  title="Quick Start" href="../../docs/quick-start/">
	
	Quick Start
</a>


        
        <ul >
           
            
            



<a  title="Creating a Project" href="../../docs/quick-start/creating-a-project/">
	
	Creating a Project
</a>

           
            
            



<a  title="Creating a Flow" href="../../docs/quick-start/creating-a-flow/">
	
	Creating a Flow
</a>

           
            
            



<a  title="Configuring Users" href="../../docs/quick-start/configuring-users/">
	
	Configuring Users
</a>

           
            
            



<a  title="Configuring a Cluster" href="../../docs/quick-start/configuring-a-cluster/">
	
	Configuring a Cluster
</a>

           
            
            



<a  title="Configuring a Registry" href="../../docs/quick-start/configuring-a-registry/">
	
	Configuring a Registry
</a>

           
            
            



<a  title="Configuring Your Repository" href="../../docs/quick-start/configuring-your-repository/">
	
	Configuring Your Repository
</a>

           
            
            



<a  title="Configuring a Flow" href="../../docs/quick-start/configuring-a-flow/">
	
	Configuring a Flow
</a>

           
            
            



<a  title="Creating a Tide" href="../../docs/quick-start/creating-a-tide/">
	
	Creating a Tide
</a>

           
            
            



<a  title="Remote Development: Installing the Client" href="../../docs/quick-start/remote-development-installing-the-client/">
	
	Remote Development: Installing the Client
</a>

           
            
            



<a  title="Remote Development: Configuring Your Repository" href="../../docs/quick-start/remote-development-configuring-your-repository/">
	
	Remote Development: Configuring Your Repository
</a>

           
            
            



<a  title="Remote Development: Creating a Remote Environment" href="../../docs/quick-start/remote-development-creating-a-remote-environment/">
	
	Remote Development: Creating a Remote Environment
</a>

           
            
            



<a  title="Remote Development: Using a Remote Environment" href="../../docs/quick-start/remote-development-using-a-remote-environment/">
	
	Remote Development: Using a Remote Environment
</a>

          
        </ul>
      
    </li>



    
    
    <li>
        



<a class="current" title="Configuration" href="../../docs/configuration/">
	
	Configuration
</a>


        
        <ul class="current">
           
            
            



<a  title="Configuration Files" href="../../docs/configuration/configuration-files/">
	
	Configuration Files
</a>

           
            
            



<a  title="Tasks" href="../../docs/configuration/tasks/">
	
	Tasks
</a>

           
            
            



<a  title="Tasks: Building Docker Images" href="../../docs/configuration/tasks-build/">
	
	Tasks: Building Docker Images
</a>

           
            
            



<a class="current" title="Tasks: Deploying Services" href="../../docs/configuration/tasks-deploy/">
	
	Tasks: Deploying Services
</a>

           
            
            



<a  title="Tasks: Running Commands" href="../../docs/configuration/tasks-run/">
	
	Tasks: Running Commands
</a>

           
            
            



<a  title="Tasks: Waiting Statuses" href="../../docs/configuration/tasks-wait/">
	
	Tasks: Waiting Statuses
</a>

           
            
            



<a  title="Tasks: Manual Approval" href="../../docs/configuration/tasks-manual-approval/">
	
	Tasks: Manual Approval
</a>

           
            
            



<a  title="Tasks: Creating Webhooks" href="../../docs/configuration/tasks-webhook/">
	
	Tasks: Creating Webhooks
</a>

           
            
            



<a  title="Notifications" href="../../docs/configuration/notifications/">
	
	Notifications
</a>

           
            
            



<a  title="Pipelines" href="../../docs/configuration/pipelines/">
	
	Pipelines
</a>

           
            
            



<a  title="Cloudflare Integration" href="../../docs/configuration/cloudflare-integration/">
	
	Cloudflare Integration
</a>

           
            
            



<a  title="Endpoints" href="../../docs/configuration/endpoints/">
	
	Endpoints
</a>

           
            
            



<a  title="Artifacts" href="../../docs/configuration/artifacts/">
	
	Artifacts
</a>

          
        </ul>
      
    </li>



    
    
    <li>
        



<a  title="Remote Development" href="../../docs/remote-development/">
	
	Remote Development
</a>


        
        <ul >
           
            
            



<a  title="Getting Started" href="../../docs/remote-development/getting-started/">
	
	Getting Started
</a>

           
            
            



<a  title="Working with a Different Environment" href="../../docs/remote-development/working-with-different-environments/">
	
	Working with a Different Environment
</a>

           
            
            



<a  title="Working with a Direct Connection to the Cluster" href="../../docs/remote-development/working-with-direct-cluster-connection/">
	
	Working with a Direct Connection to the Cluster
</a>

           
            
            



<a  title="Advanced Setup" href="../../docs/remote-development/advanced-setup/">
	
	Advanced Setup
</a>

           
            
            



<a  title="Command: Init" href="../../docs/remote-development/command-init/">
	
	Command: Init
</a>

           
            
            



<a  title="Command: Setup" href="../../docs/remote-development/command-setup/">
	
	Command: Setup
</a>

           
            
            



<a  title="Command: Build" href="../../docs/remote-development/command-build/">
	
	Command: Build
</a>

           
            
            



<a  title="Command: Logs" href="../../docs/remote-development/command-logs/">
	
	Command: Logs
</a>

           
            
            



<a  title="Command: Bash" href="../../docs/remote-development/command-bash/">
	
	Command: Bash
</a>

           
            
            



<a  title="Command: Exec" href="../../docs/remote-development/command-exec/">
	
	Command: Exec
</a>

           
            
            



<a  title="Command: Watch" href="../../docs/remote-development/command-watch/">
	
	Command: Watch
</a>

           
            
            



<a  title="Command: Fetch" href="../../docs/remote-development/command-fetch/">
	
	Command: Fetch
</a>

           
            
            



<a  title="Command: Push" href="../../docs/remote-development/command-push/">
	
	Command: Push
</a>

           
            
            



<a  title="Command: Sync" href="../../docs/remote-development/command-sync/">
	
	Command: Sync
</a>

           
            
            



<a  title="Command: Delete" href="../../docs/remote-development/command-delete/">
	
	Command: Delete
</a>

           
            
            



<a  title="Command: Forward" href="../../docs/remote-development/command-forward/">
	
	Command: Forward
</a>

           
            
            



<a  title="Command: Pods" href="../../docs/remote-development/command-pods/">
	
	Command: Pods
</a>

           
            
            



<a  title="Command: Check Connection" href="../../docs/remote-development/command-check-connection/">
	
	Command: Check Connection
</a>

           
            
            



<a  title="Command: Destroy" href="../../docs/remote-development/command-destroy/">
	
	Command: Destroy
</a>

           
            
            



<a  title="Release Notes v0.1.0" href="../../docs/remote-development/release-notes-0-1-0/">
	
	Release Notes v0.1.0
</a>

           
            
            



<a  title="Release Notes v0.1.1" href="../../docs/remote-development/release-notes-0-1-1/">
	
	Release Notes v0.1.1
</a>

           
            
            



<a  title="Release Notes v0.1.2" href="../../docs/remote-development/release-notes-0-1-2/">
	
	Release Notes v0.1.2
</a>

           
            
            



<a  title="Release Notes v0.1.3" href="../../docs/remote-development/release-notes-0-1-3/">
	
	Release Notes v0.1.3
</a>

           
            
            



<a  title="Release Notes v0.1.4" href="../../docs/remote-development/release-notes-0-1-4/">
	
	Release Notes v0.1.4
</a>

           
            
            



<a  title="Release Notes v0.1.5" href="../../docs/remote-development/release-notes-0-1-5/">
	
	Release Notes v0.1.5
</a>

          
        </ul>
      
    </li>



    
    
    <li>
        



<a  title="FAQ" href="../../docs/faq/">
	
	FAQ
</a>


        
        <ul >
           
            
            



<a  title="Billing Profile" href="../../docs/faq/how-do-I-create-a-billing-profile/">
	
	Billing Profile
</a>

           
            
            



<a  title="ContinuousPipe Images" href="../../docs/faq/what-are-the-continuous-pipe-images/">
	
	ContinuousPipe Images
</a>

           
            
            



<a  title="ContinuousPipe Demo Sites" href="../../docs/faq/what-are-the-continuous-pipe-demo-sites/">
	
	ContinuousPipe Demo Sites
</a>

           
            
            



<a  title="ContinuousPipe API Keys" href="../../docs/faq/where-can-I-get-a-continuous-pipe-api-key/">
	
	ContinuousPipe API Keys
</a>

           
            
            



<a  title="Deployment Logs and Events" href="../../docs/faq/where-can-I-view-container-logs-and-events/">
	
	Deployment Logs and Events
</a>

           
            
            



<a  title="Setting Environment Variables" href="../../docs/faq/how-do-I-set-environment-variables/">
	
	Setting Environment Variables
</a>

           
            
            



<a  title="Controlling Deployments" href="../../docs/faq/how-do-I-control-deployments-using-pr-labels/">
	
	Controlling Deployments
</a>

           
            
            



<a  title="Using Defaults" href="../../docs/faq/how-do-I-use-defaults-to-reduce-the-duplication-of-configuration/">
	
	Using Defaults
</a>

           
            
            



<a  title="Setup GitHub Token" href="../../docs/faq/how-do-I-use-composer-with-github-access-token/">
	
	Setup GitHub Token
</a>

           
            
            



<a  title="Using Pipelines" href="../../docs/faq/how-do-I-use-pipelines-to-simplify-the-configuration/">
	
	Using Pipelines
</a>

           
            
            



<a  title="Basic Authentication" href="../../docs/faq/how-do-I-add-basic-http-authentication-to-an-application/">
	
	Basic Authentication
</a>

           
            
            



<a  title="Overriding Tasks" href="../../docs/faq/how-do-I-override-tasks-in-pipelines/">
	
	Overriding Tasks
</a>

           
            
            



<a  title="Manual Approval" href="../../docs/faq/how-do-I-set-up-manual-approval-of-deployments/">
	
	Manual Approval
</a>

           
            
            



<a  title="Readiness Checks on Services" href="../../docs/faq/how-do-I-define-a-readiness-check-when-deploying-services/">
	
	Readiness Checks on Services
</a>

           
            
            



<a  title="Get Endpoint Address for a Service" href="../../docs/faq/how-do-I-get-the-deployed-endpoint-address-for-a-service/">
	
	Get Endpoint Address for a Service
</a>

           
            
            



<a  title="Slack Notifications" href="../../docs/faq/how-do-I-configure-slack-notifications/">
	
	Slack Notifications
</a>

           
            
            



<a  title="Watch Commands and Inotify" href="../../docs/faq/how-do-I-configure-inotify-for-development-tool-watch-commands/">
	
	Watch Commands and Inotify
</a>

          
        </ul>
      
    </li>



    
    
    <li>
        



<a  title="Guides" href="../../docs/guides/">
	
	Guides
</a>


        
        <ul >
           
            
            



<a  title="Getting Started with Laravel" href="../../docs/guides/laravel/">
	
	Getting Started with Laravel
</a>

           
            
            



<a  title="Getting Started with Symfony" href="../../docs/guides/symfony/">
	
	Getting Started with Symfony
</a>

           
            
            



<a  title="Getting Started with Drupal" href="../../docs/guides/drupal/">
	
	Getting Started with Drupal
</a>

           
            
            



<a  title="Xdebug Remote Environment" href="../../docs/guides/remote-environment-xdebug/">
	
	Xdebug Remote Environment
</a>

          
        </ul>
      
    </li>



        </ul>
        

      </div>
    </div>
  </div>
</nav>

    </div>

    <article class="article">
        <div class="wrapper">
            
<h1>Tasks: Deploying Services </h1>



<p>Whether you are using a pre-built image or needed to build an image, you can now deploy it. For this you need to use the <code>deploy</code> task, which is one of the <a href="../../docs/configuration/tasks/#inbuilt-tasks">inbuilt tasks</a>.</p>

<p>The <code>deploy</code> task is configurable in many ways. The following examples assume that you have at least a <code>web</code> and a <code>database</code> service configured in your <code>docker-compose.yml</code> file.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">tasks</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">deployment</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">deploy</span><span style="color: #f8f8f2">:</span>
            <span style="color: #ae81ff">cluster</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">my-cluster-identifier</span>

            <span style="color: #ae81ff">services</span><span style="color: #f8f8f2">:</span>
                <span style="color: #ae81ff">web</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">~</span>
                <span style="color: #ae81ff">database</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">~</span>
</pre></div>

<p>For each of these services, you can fine tune a lot of options that are presented in the following paragraphs. Therefore, the full YAML structure won&rsquo;t be presented but assume that every option is under a service configuration like this one:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">tasks</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">deployment</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">deploy</span><span style="color: #f8f8f2">:</span>
            <span style="color: #ae81ff">services</span><span style="color: #f8f8f2">:</span>
                <span style="color: #ae81ff">database</span><span style="color: #f8f8f2">:</span>
                    <span style="color: #ae81ff">source</span><span style="color: #f8f8f2">:</span>
                        <span style="color: #ae81ff">image</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">mysql</span>
</pre></div>

<h2 id="image-source">Image Source</h2>

<p>If you have a <a href="../../docs/configuration/tasks/"><code>build</code> task</a> before the deployment task and an image for the service with the same name was built just before, this image name will be used automatically, so you have nothing to configure.</p>

<p>If that&rsquo;s not the case, the first way to reference an image is to explicitly mention the image name. Note that this value is automatically guessed if you have a service having the same name in your project&rsquo;s <code>docker-compose.yml</code> file.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">specification</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">source</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">image</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">mysql</span>
        <span style="color: #ae81ff">tag</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">latest</span>
</pre></div>

<p>The second way to reference an image, if for instance you are deploying the same image but with different runtime commands, is to use a source from a given service:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">specification</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">source</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">from_service</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">web</span>
</pre></div>

<h2 id="environment-name">Environment Name</h2>

<p>You can configure the name of the deployed environment (the namespace in Kubernetes terms) using an expression:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">environment</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;&quot;my-app-&quot;</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">~</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">code_reference.branch&#39;</span>
</pre></div>

<h2 id="deployment-strategy">Deployment Strategy</h2>

<p>The deployment strategy describes how would you like the container(s) to be deployed.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">deployment_strategy</span><span style="color: #f8f8f2">:</span>
    <span style="color: #75715e"># If true, the locked parameter ensure that the container(s) won&#39;t ever</span>
    <span style="color: #75715e"># be updated once created</span>
    <span style="color: #ae81ff">locked</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">false</span>

    <span style="color: #75715e"># If true, an attached container means that ContinuousPipe will wait this container</span>
    <span style="color: #75715e"># to have finished its job and stream the output</span>
    <span style="color: #ae81ff">attached</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">false</span>

    <span style="color: #75715e"># If true, the existing container will be forced to be reset</span>
    <span style="color: #75715e"># at each deployment</span>
    <span style="color: #ae81ff">reset</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">false</span>
</pre></div>

<h2 id="environment-variables">Environment Variables</h2>

<p>You can set environment variables that will be injected in the running containers.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">specification</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">environment_variables</span><span style="color: #f8f8f2">:</span>
        <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">VARIABLE_NAME</span>
          <span style="color: #ae81ff">value</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">the-value</span>
        <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">ANOTHER_VALUE</span>
          <span style="color: #ae81ff">value</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">${USING_A_VARIABLE}</span>
</pre></div>

<h2 id="ports">Ports</h2>

<p>In order to expose some services to other ones or through a load-balancer, you need to define which ports are exposed by this service.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">specification</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">ports</span><span style="color: #f8f8f2">:</span>
        <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">80</span>
</pre></div>

<p>There may be instances where you need to define the protocol for your ports. Allowed protocols are <code>TCP</code> and <code>UDP</code>. <code>TCP</code> is set by default. To change this you may add the following -</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">specification</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">ports</span><span style="color: #f8f8f2">:</span>
        <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">protocol</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;UDP&#39;</span>
          <span style="color: #ae81ff">identifier</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;udp-1812&#39;</span>
          <span style="color: #ae81ff">port</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">1812</span>
</pre></div>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>AWS ELB doesn&rsquo;t currently support UDP.</p>
</div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have an <code>expose</code> configuration in your <code>docker-compose.yml</code> file, this configuration will be filled automatically.</p>
</div>

<h2 id="accessibility">Accessibility</h2>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">specification</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">accessibility</span><span style="color: #f8f8f2">:</span>
        <span style="color: #75715e"># If true, the service will be accessible from inside the cluster by other services.</span>
        <span style="color: #ae81ff">from_cluster</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>

        <span style="color: #75715e"># If true, a public load-balancer will be created for this service.</span>
        <span style="color: #ae81ff">from_external</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">false</span>
</pre></div>

<h2 id="endpoints">Endpoints</h2>

<p>In most cases, the <code>from_external</code> accessibility value is enough to configure an endpoint. However, if you are using a cluster that supports Ingress and SSL certificates, then you can use the <code>endpoints</code> configuration to define these endpoints:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">endpoints</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">-</span>
        <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">https</span>
        <span style="color: #ae81ff">type</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">NodePort</span>
        <span style="color: #ae81ff">ssl_certificates</span><span style="color: #f8f8f2">:</span>
            <span style="color: #f8f8f2">-</span>
                <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">your-certificate-name</span>
                <span style="color: #ae81ff">cert</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">${WILDCARD_SSL_CERT}</span>
                <span style="color: #ae81ff">key</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">${WILDCARD_SSL_KEY}</span>
</pre></div>

<p>The documentation on <a href="../../docs/configuration/endpoints/">endpoints</a> gives more details on how to use Ingress and SSL.</p>

<h2 id="basic-http-authentication">Basic HTTP Authentication</h2>

<p>If you are using one of the <a href="../../docs/faq/what-are-the-continuous-pipe-images/">ContinuousPipe images</a> for <a href="https://github.com/continuouspipe/dockerfiles/tree/master/php-apache#basic-authentication">Apache</a> or <a href="https://github.com/continuouspipe/dockerfiles/tree/master/php-nginx#basic-authentication">Nginx</a> then you can enable basic auth using environment variables:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">specification</span><span style="color: #f8f8f2">:</span>
   <span style="color: #ae81ff">environment_variables</span><span style="color: #f8f8f2">:</span>
       <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">AUTH_HTTP_</span>
       
         <span style="color: #ae81ff">value</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
       <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">AUTH_HTTP_HTPASSWD</span>
         <span style="color: #ae81ff">value</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">${AUTH_HTTP_HTPASSWD}</span>
</pre></div>

<p>Here the value of <code>AUTH_HTTP_HTPASSWD</code> is being passed in as a variable to keep it out of version control, this needs to be set on the <a href="../../docs/quick-start/configuring-a-flow/">configuration page for the flow</a> in the ContinuousPipe console.</p>

<h2 id="conditional-services">Conditional Services</h2>

<p>If you need to not deploy some services on a given condition, you can use the <code>condition</code> expression:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">condition</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">code_reference.branch not in [&quot;production&quot;, &quot;uat&quot;, &quot;integration&quot;]</span>
</pre></div>

<h2 id="persistent-volumes">Persistent Volumes</h2>

<p>If you want some volumes containing data that will be persistent across the deployments, you can mount some persistent volumes:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">specification</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">volumes</span><span style="color: #f8f8f2">:</span>
        <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">type</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">persistent</span>
          <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">my-volume</span>
          <span style="color: #ae81ff">capacity</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">5Gi</span>
          <span style="color: #ae81ff">storage_class</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">default</span>
    <span style="color: #ae81ff">volume_mounts</span><span style="color: #f8f8f2">:</span>
        <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">my-volume</span>
          <span style="color: #ae81ff">mount_path</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/data</span>
</pre></div>

<h2 id="resources">Resources</h2>

<p>You can define the amount of requested resources, as well as the resource limits for your services. These values will be applied to each replicated container individually.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">specification</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">resources</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">requests</span><span style="color: #f8f8f2">:</span>
            <span style="color: #ae81ff">cpu</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">50m</span>
            <span style="color: #ae81ff">memory</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">250Mi</span>
        <span style="color: #ae81ff">limits</span><span style="color: #f8f8f2">:</span>
            <span style="color: #ae81ff">cpu</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">500m</span>
            <span style="color: #ae81ff">memory</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">500Mi</span>
</pre></div>

<h2 id="replicas-and-redundancy">Replicas and Redundancy</h2>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A replica is copy of a service (as defined in your <code>docker-compose.yml</code> or <code>continuous-pipe.yml</code> file) running in the cluster.</p>
</div>

<p>By default a service is configured to have a single replica. You may want to provide redundancy for a service across multiple nodes to make your application more resilient. This can be done by increasing the number of replicas:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">specification</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">scalability</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">number_of_replicas</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">5</span>
</pre></div>

<p>Upon deployment, your service will be transformed to a Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a> object that will create a <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pod</a> object. If you would like to only create the Pod object (not recommend), you can use this configuration:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">specification</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">scalability</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">enabled</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">false</span>
</pre></div>

<h2 id="health-checks">Health-checks</h2>

<p>Health-checks (also called probes) help to identify when a container is ready during a deployment and when a container is still alive when deployed:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">deployment_strategy</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">readiness_probe</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">type</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">tcp</span>
        <span style="color: #ae81ff">port</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">6379</span>

    <span style="color: #ae81ff">liveness_probe</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">initial_delay_seconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">5</span>
        <span style="color: #ae81ff">timeout_seconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">5</span>
        <span style="color: #ae81ff">period_seconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">5</span>
        <span style="color: #ae81ff">type</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">http</span>
        <span style="color: #ae81ff">port</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">80</span>
        <span style="color: #ae81ff">path</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/healthz</span>
</pre></div>

<p>Sometimes your container won&rsquo;t be listening on the relevant port by the time the readiness probe runs but you will still want to check that it is functioning. A good idea would be to check that a file can be created in a directory such as /tmp:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">deployment_strategy</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">readiness_probe</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">type</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">exec</span>
        <span style="color: #ae81ff">command</span><span style="color: #f8f8f2">:</span>
            <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">touch</span>
            <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">/tmp/healthy</span>
        <span style="color: #ae81ff">initial_delay_seconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">5</span>
        <span style="color: #ae81ff">period_seconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">5</span>
        <span style="color: #ae81ff">success_threshold</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">1</span>
        <span style="color: #ae81ff">failure_threshold</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">10</span>
</pre></div>

<h2 id="retrieving-deployed-endpoint-addresses">Retrieving Deployed Endpoint Addresses</h2>

<p>You may have a complex script that contains several <code>deploy</code> tasks, each creating their own endpoint. To inform subsequent services about a previous endpoint address ContinuousPipe creates a dynamic variable using the service name.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">tasks</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">infrastructure</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">deploy</span><span style="color: #f8f8f2">:</span>
            <span style="color: #ae81ff">services</span><span style="color: #f8f8f2">:</span>
                <span style="color: #ae81ff">backend</span><span style="color: #f8f8f2">:</span>
                    <span style="color: #75715e"># ...</span>

    <span style="color: #ae81ff">application</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">deploy</span><span style="color: #f8f8f2">:</span>
            <span style="color: #ae81ff">services</span><span style="color: #f8f8f2">:</span>
                <span style="color: #ae81ff">frontend</span><span style="color: #f8f8f2">:</span>
                    <span style="color: #ae81ff">specification</span><span style="color: #f8f8f2">:</span>
                        <span style="color: #ae81ff">environment_variables</span><span style="color: #f8f8f2">:</span>
                            <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">BACKEND_ENDPOINT</span>
                              <span style="color: #ae81ff">value</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">${SERVICE_BACKEND_PUBLIC_ENDPOINT}</span>
</pre></div>

<p>This configuration defines an initial <code>deploy</code> task that creates a <code>backend</code> service. The second <code>deploy</code> task creates a <code>frontend</code> service that passes the endpoint address of the <code>backend</code> service as an environment variable <code>BACKEND_ENDPOINT</code> using the dynamic variable <code>${SERVICE_BACKEND_PUBLIC_ENDPOINT}</code> as the value.</p>



        </div>
    </article>

    <footer class="footer" style="margin-top: 20px;">
        





<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="../../docs/configuration/tasks-build/" title="Tasks: Building Docker Images">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Tasks: Building Docker Images
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="../../docs/configuration/tasks-run/" title="Tasks: Running Commands">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Tasks: Running Commands
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





    </footer>

    <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
            <div class="wrapper">
                <div class="meta"></div>
                <div class="list"></div>
            </div>
        </div>
    </div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="../../docs/javascripts/application.js"></script>
    
    <script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
    
    <script src="../../docs/javascripts/jquery-3.1.1.min.js"></script>
    
    <script src="../../docs/javascripts/menu.js"></script>
    

    <script>
    /* Removes redundant event listener from material theme */
    window.addEventListener('load', function () {
        var searchToggle = document.querySelector("#toggle-search");
        var searchLabel = document.querySelector("[for=\"toggle-search\"]");
        var algoliaInput = document.querySelector("#algolia-query");

        function elementReset(elem) {
            elem.parentNode.replaceChild(elem.cloneNode(true), elem);
        }

        elementReset(searchToggle);
        searchLabel.addEventListener('click', function() {
            algoliaInput.focus();
        }, false);
    }, false);
    </script>

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>
    <script type="text/javascript"> 
    docsearch({
        apiKey: '608036855612fb9a0dd2e9a2c09955bc',
        indexName: 'continuouspipe',
        inputSelector: '#algolia-query',
        debug: true 
    });
    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-71216332-1', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>

